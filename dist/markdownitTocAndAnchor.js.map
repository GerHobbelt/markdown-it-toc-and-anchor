{"version":3,"file":"markdownItTocAndAnchor.modern.js","sources":["../node_modules/@gerhobbelt/markdown-it/lib/token.js","../index.js"],"sourcesContent":["// Token class\n\n\n\n\n/**\n * class Token\n **/\n\n/**\n * new Token(type, tag, nesting)\n *\n * Create new token and fill passed properties.\n **/\nfunction Token(type, tag, nesting) {\n  /**\n   * Token#type -> String\n   *\n   * Type of the token (string, e.g. \"paragraph_open\")\n   **/\n  this.type     = type;\n\n  /**\n   * Token#tag -> String\n   *\n   * html tag name, e.g. \"p\"\n   **/\n  this.tag      = tag;\n\n  /**\n   * Token#attrs -> Array\n   *\n   * Html attributes. Format: `[ [ name1, value1 ], [ name2, value2 ] ]`\n   **/\n  this.attrs    = null;\n\n  /**\n   * Token#map -> Array\n   *\n   * Source map info. Format: `[ line_begin, line_end ]`\n   **/\n  this.map      = null;\n\n  /**\n   * Token#nesting -> Number\n   *\n   * Level change (number in {-1, 0, 1} set), where:\n   *\n   * -  `1` means the tag is opening\n   * -  `0` means the tag is self-closing\n   * - `-1` means the tag is closing\n   **/\n  this.nesting  = nesting;\n\n  /**\n   * Token#level -> Number\n   *\n   * nesting level, the same as `state.level`\n   **/\n  this.level    = 0;\n\n  /**\n   * Token#children -> Array\n   *\n   * An array of child nodes (inline and img tokens)\n   **/\n  this.children = null;\n\n  /**\n   * Token#content -> String\n   *\n   * In a case of self-closing tag (code, html, fence, etc.),\n   * it has contents of this tag.\n   **/\n  this.content  = '';\n\n  /**\n   * Token#markup -> String\n   *\n   * '*' or '_' for emphasis, fence string for fence, etc.\n   **/\n  this.markup   = '';\n\n  /**\n   * Token#info -> String\n   *\n   * fence infostring\n   **/\n  this.info     = '';\n\n  /**\n   * Token#meta -> Object\n   *\n   * A place for plugins to store an arbitrary data\n   **/\n  this.meta     = null;\n\n  /**\n   * Token#block -> Boolean\n   *\n   * True for block-level tokens, false for inline tokens.\n   * Used in renderer to calculate line breaks\n   **/\n  this.block    = false;\n\n  /**\n   * Token#hidden -> Boolean\n   *\n   * If it's true, ignore this element when rendering. Used for tight lists\n   * to hide paragraphs.\n   **/\n  this.hidden   = false;\n\n  /**\n   * Token#position -> Number\n   *\n   * Position in the original string\n   **/\n  this.position = 0;\n\n  /**\n   * Token#size -> Number\n   *\n   * Size of the token\n   **/\n  this.size     = 0;\n}\n\n\n/**\n * Token.attrIndex(name) -> Number\n *\n * Search attribute index by name.\n **/\nToken.prototype.attrIndex = function attrIndex(name) {\n  let attrs;\n\n  if (!this.attrs) { return -1; }\n\n  attrs = this.attrs;\n\n  return attrs.findIndex(function (el) {\n    return el[0] === name;\n  });\n};\n\n\n/**\n * Token.attrPush(attrData)\n *\n * Add `[ name, value ]` attribute to list. Init attrs if necessary\n **/\nToken.prototype.attrPush = function attrPush(attrData) {\n  if (this.attrs) {\n    this.attrs.push(attrData);\n  } else {\n    this.attrs = [ attrData ];\n  }\n};\n\n\n/**\n * Token.attrSet(name, value)\n *\n * Set `name` attribute to `value`. Override old value if exists.\n **/\nToken.prototype.attrSet = function attrSet(name, value) {\n  let idx = this.attrIndex(name),\n      attrData = [ name, value ];\n\n  if (idx < 0) {\n    this.attrPush(attrData);\n  } else {\n    this.attrs[idx] = attrData;\n  }\n};\n\n\n/**\n * Token.attrGet(name)\n *\n * Get the value of attribute `name`, or null if it does not exist.\n **/\nToken.prototype.attrGet = function attrGet(name) {\n  let idx = this.attrIndex(name), value = null;\n  if (idx >= 0) {\n    value = this.attrs[idx][1];\n  }\n  return value;\n};\n\n\n/**\n * Token.attrJoin(name, value)\n *\n * Join value to existing attribute via space. Or create new attribute if not\n * exists. Useful to operate with token classes.\n **/\nToken.prototype.attrJoin = function attrJoin(name, value) {\n  let idx = this.attrIndex(name);\n\n  if (idx < 0) {\n    this.attrPush([ name, value ]);\n  } else {\n    this.attrs[idx][1] = this.attrs[idx][1] + ' ' + value;\n  }\n};\n\n\n/**\n * Token.clone()\n *\n * Obtain a shallow clone of the token.  You can use this while rendering to\n * prevent modifying the token list while rendering.\n **/\n\nToken.prototype.clone = function clone() {\n  let token = new Token(this.type, this.tag, this.nesting);\n\n  token.attrs = this.attrs;\n  token.level = this.level;\n  token.children = this.children;\n  token.content = this.content;\n  token.map = this.map;\n  token.markup = this.markup;\n  token.info = this.info;\n  token.meta = this.meta;\n  token.block = this.block;\n  token.hidden = this.hidden;\n\n  return token;\n};\n\nmodule.exports = Token;\n","import clone from 'clone';\nimport uslug from 'uslug';\nimport Token from '@gerhobbelt/markdown-it/lib/token';\n\nconst TOC = '@[toc]';\nconst TOC_RE = /^@\\[toc\\]/im;\n\nlet markdownItSecondInstance = () => {};\nlet headingIds = {};\nlet tocHtml = '';\n\nconst repeat = (string, num) => new Array(num + 1).join(string);\n\nconst makeSafe = (string, headingIds, slugifyFn) => {\n  const key = slugifyFn(string); // slugify\n  if (!headingIds[key]) {\n    headingIds[key] = 0;\n  }\n  headingIds[key]++;\n  return key + (headingIds[key] > 1 ? `-${headingIds[key]}` : '');\n};\n\nconst space = () => {\n  return { ...new Token('text', '', 0), content: ' ' };\n};\n\nconst renderAnchorLinkSymbol = options => {\n  if (options.anchorLinkSymbolClassName) {\n    return [\n      {\n        ...new Token('span_open', 'span', 1),\n        attrs: [ [ 'class', options.anchorLinkSymbolClassName ] ]\n      },\n      {\n        ...new Token('text', '', 0),\n        content: options.anchorLinkSymbol\n      },\n      new Token('span_close', 'span', -1)\n    ];\n  }\n  return [\n    {\n      ...new Token('text', '', 0),\n      content: options.anchorLinkSymbol\n    }\n  ];\n\n};\n\nconst renderAnchorLink = (anchor, options, tokens, idx) => {\n  const attrs = [];\n\n  if (options.anchorClassName != null) {\n    attrs.push([ 'class', options.anchorClassName ]);\n  }\n\n  attrs.push([ 'href', `#${anchor}` ]);\n\n  const openLinkToken = {\n    ...new Token('link_open', 'a', 1),\n    attrs\n  };\n  const closeLinkToken = new Token('link_close', 'a', -1);\n\n  if (options.wrapHeadingTextInAnchor) {\n    tokens[idx + 1].children.unshift(openLinkToken);\n    tokens[idx + 1].children.push(closeLinkToken);\n  } else {\n    const linkTokens = [\n      openLinkToken,\n      ...renderAnchorLinkSymbol(options),\n      closeLinkToken\n    ];\n\n    // `push` or `unshift` according to anchorLinkBefore option\n    // space is at the opposite side.\n    const actionOnArray = {\n      'false': 'push',\n      'true': 'unshift'\n    };\n\n    // insert space between anchor link and heading ?\n    if (options.anchorLinkSpace) {\n      linkTokens[actionOnArray[!options.anchorLinkBefore]](space());\n    }\n    tokens[idx + 1].children[actionOnArray[options.anchorLinkBefore]](\n      ...linkTokens\n    );\n  }\n};\n\nconst treeToMarkdownBulletList = (tree, indent = 0) =>\n  tree\n    .map(item => {\n      const indentation = '  ';\n      let node = `${repeat(indentation, indent)}*`;\n      if (item.heading.content) {\n        const contentWithoutAnchor = item.heading.content.replace(\n          /\\[([^\\]]*)\\]\\([^)]*\\)/g,\n          '$1'\n        );\n        node += ' ' + `[${contentWithoutAnchor}](#${item.heading.anchor})\\n`;\n      } else {\n        node += '\\n';\n      }\n      if (item.nodes.length) {\n        node += treeToMarkdownBulletList(item.nodes, indent + 1);\n      }\n      return node;\n    })\n    .join('');\n\nconst generateTocMarkdownFromArray = (headings, options) => {\n  const tree = { nodes: [] };\n  // create an ast\n  headings.forEach(heading => {\n    if (\n      heading.level < options.tocFirstLevel ||\n      heading.level > options.tocLastLevel\n    ) {\n      return;\n    }\n\n    let i = 1;\n    let lastItem = tree;\n    for (; i < heading.level - options.tocFirstLevel + 1; i++) {\n      if (lastItem.nodes.length === 0) {\n        lastItem.nodes.push({\n          heading: {},\n          nodes: []\n        });\n      }\n      lastItem = lastItem.nodes[lastItem.nodes.length - 1];\n    }\n    lastItem.nodes.push({\n      heading: heading,\n      nodes: []\n    });\n  });\n\n  return treeToMarkdownBulletList(tree.nodes);\n};\n\nexport default function (md, options) {\n  options = {\n    toc: true,\n    tocClassName: 'markdownIt-TOC',\n    tocFirstLevel: 1,\n    tocLastLevel: 6,\n    tocCallback: null,\n    anchorLink: true,\n    anchorLinkSymbol: '#',\n    anchorLinkBefore: true,\n    anchorClassName: 'markdownIt-Anchor',\n    resetIds: true,\n    anchorLinkSpace: true,\n    anchorLinkSymbolClassName: null,\n    wrapHeadingTextInAnchor: false,\n    ...options\n  };\n\n  markdownItSecondInstance = clone(md);\n\n  // initialize key ids for each instance\n  headingIds = {};\n\n  md.core.ruler.push('init_toc', function (state) {\n    const tokens = state.tokens;\n\n    // reset key ids for each document\n    if (options.resetIds) {\n      headingIds = {};\n    }\n\n    const tocArray = [];\n    let tocMarkdown = '';\n    let tocTokens = [];\n\n    const slugifyFn =\n      (typeof options.slugify === 'function' && options.slugify) || uslug;\n\n    for (let i = 0; i < tokens.length; i++) {\n      if (tokens[i].type !== 'heading_close') {\n        continue;\n      }\n\n      const heading = tokens[i - 1];\n      const heading_close = tokens[i];\n\n      if (heading.type === 'inline') {\n        let content;\n        if (\n          heading.children &&\n          heading.children.length > 0 &&\n          heading.children[0].type === 'link_open'\n        ) {\n          // headings that contain links have to be processed\n          // differently since nested links aren't allowed in markdown\n          content = heading.children[1].content;\n          heading._tocAnchor = makeSafe(content, headingIds, slugifyFn);\n        } else {\n          content = heading.content;\n          heading._tocAnchor = makeSafe(\n            heading.children.reduce((acc, t) => acc + t.content, ''),\n            headingIds,\n            slugifyFn\n          );\n        }\n\n        if (options.anchorLinkPrefix) {\n          heading._tocAnchor = options.anchorLinkPrefix + heading._tocAnchor;\n        }\n\n        tocArray.push({\n          content,\n          anchor: heading._tocAnchor,\n          level: +heading_close.tag.substr(1, 1)\n        });\n      }\n    }\n\n    tocMarkdown = generateTocMarkdownFromArray(tocArray, options);\n\n    tocTokens = markdownItSecondInstance.parse(tocMarkdown, {});\n\n    // Adding tocClassName to 'ul' element\n    if (\n      typeof tocTokens[0] === 'object' &&\n      tocTokens[0].type === 'bullet_list_open'\n    ) {\n      const attrs = (tocTokens[0].attrs = tocTokens[0].attrs || []);\n\n      if (options.tocClassName != null) {\n        attrs.push([ 'class', options.tocClassName ]);\n      }\n    }\n\n    tocHtml = markdownItSecondInstance.renderer.render(\n      tocTokens,\n      markdownItSecondInstance.options\n    );\n\n    if (typeof state.env.tocCallback === 'function') {\n      state.env.tocCallback.call(undefined, tocMarkdown, tocArray, tocHtml);\n    } else if (typeof options.tocCallback === 'function') {\n      options.tocCallback.call(undefined, tocMarkdown, tocArray, tocHtml);\n    } else if (typeof md.options.tocCallback === 'function') {\n      md.options.tocCallback.call(undefined, tocMarkdown, tocArray, tocHtml);\n    }\n  });\n\n  md.inline.ruler.after('emphasis', 'toc', (state, silent) => {\n    let token;\n    let match;\n\n    if (\n      // Reject if the token does not start with @[\n      state.src.charCodeAt(state.pos) !== 0x40 ||\n      state.src.charCodeAt(state.pos + 1) !== 0x5b ||\n      // Donâ€™t run any pairs in validation mode\n      silent\n    ) {\n      return false;\n    }\n\n    // Detect TOC markdown\n    match = TOC_RE.exec(state.src);\n    match = !match ? [] : match.filter(m => m);\n    if (match.length < 1) {\n      return false;\n    }\n\n    // Build content\n    token = state.push('toc_open', 'toc', 1);\n    token.markup = TOC;\n    token = state.push('toc_body', '', 0);\n    token = state.push('toc_close', 'toc', -1);\n\n    // Update pos so the parser can continue\n    state.pos += 6;\n\n    return true;\n  });\n\n  const originalHeadingOpen =\n    md.renderer.rules.heading_open ||\n    function (...args) {\n      const [ tokens, idx, options, , self ] = args;\n      return self.renderToken(tokens, idx, options);\n    };\n\n  md.renderer.rules.heading_open = function (...args) {\n    const [ tokens, idx, , , ] = args;\n\n    const attrs = (tokens[idx].attrs = tokens[idx].attrs || []);\n    const anchor = tokens[idx + 1]._tocAnchor;\n    attrs.push([ 'id', anchor ]);\n\n    if (options.anchorLink) {\n      renderAnchorLink(anchor, options, ...args);\n    }\n\n    return originalHeadingOpen.apply(this, args);\n  };\n\n  md.renderer.rules.toc_open = () => '';\n  md.renderer.rules.toc_close = () => '';\n  md.renderer.rules.toc_body = () => '';\n\n  if (options.toc) {\n    md.renderer.rules.toc_body = () => tocHtml;\n  }\n}\n"],"names":["TOC","TOC_RE","markdownItSecondInstance","headingIds","tocHtml","repeat","string","num","Array","join","makeSafe","slugifyFn","key","space","Token","content","renderAnchorLinkSymbol","options","anchorLinkSymbolClassName","attrs","anchorLinkSymbol","renderAnchorLink","anchor","tokens","idx","anchorClassName","push","openLinkToken","closeLinkToken","wrapHeadingTextInAnchor","children","unshift","linkTokens","actionOnArray","anchorLinkSpace","anchorLinkBefore","treeToMarkdownBulletList","tree","indent","map","item","indentation","node","heading","contentWithoutAnchor","replace","nodes","length","generateTocMarkdownFromArray","headings","forEach","level","tocFirstLevel","tocLastLevel","i","lastItem","md","toc","tocClassName","tocCallback","anchorLink","resetIds","clone","core","ruler","state","tocArray","tocMarkdown","tocTokens","slugify","uslug","type","heading_close","_tocAnchor","reduce","acc","t","anchorLinkPrefix","tag","substr","parse","renderer","render","env","call","undefined","inline","after","silent","token","match","src","charCodeAt","pos","exec","filter","m","markup","originalHeadingOpen","rules","heading_open","args","self","renderToken","apply","toc_open","toc_close","toc_body"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,IAAI,OAAO,IAAI,CAAC;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,GAAG,QAAQ,GAAG,CAAC;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,KAAK,MAAM,IAAI,CAAC;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,GAAG,QAAQ,IAAI,CAAC;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,KAAK,MAAM,CAAC,CAAC;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,MAAM,KAAK,EAAE,CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,IAAI,OAAO,EAAE,CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,IAAI,OAAO,IAAI,CAAC;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,KAAK,MAAM,KAAK,CAAC;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,MAAM,KAAK,KAAK,CAAC;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;AACpB;AACA;AACA;AACA;AACA;AACA;AACA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"}